待学：
- 集线器、网桥、交换机、路由器
- VOIP

杂：
- 环回地址：127.0.0.1，不仅仅是这一个，主机号为127的地址保留为环回地址，向主机号127发送的数据都报不会出现在网络上


- CSMA/CD
载波侦听多路访问/冲突检测
有了交换机之后，基本退出历史舞台，除非网卡工作在半双工环境下，比如通过集线器相连的电脑



- DHCP
dynamic host configuration protocol
应用层协议，基于UDP
DHCP server会保留一份过去IP地址分配情况的表，所以通常情况你在同一个网络下每次被分到的IP地址都是一样的
4个步骤：
c -> s: discovery
客户端发送广播，目的ip地址全1，包含了自己的mac地址，请求ip地址
s -> c: offer:
服务器回复广播，表明打算分配某个ip地址给客户端。
如果客户端曾经分配过，会向上次分配的ip地址发去请求，路由器收到请求后，从本地存储的ip到mac的映射(ARP缓存表)中找到对应的客户端，将请求发送过去。
这样可以避免使用广播
c -> s: request
客户端收到了offer，回复一个request，表明我就要这个ip地址了
s -> c: acknowledgement
服务器收到了request，回复一下没问题，这个就分配给你了

租约过了一半之后，客户端会尝试续约，发送unicast request给服务器，如果服务器响应了，那没问题，续约成功。
如果没响应，会持续尝试，如果一段时间内都没有响应，会发送broadcast request，如果有其他服务器相应了，那没问题，重新绑定，续租下去
如果上一步还是失败了，最后租约过期了，重新从discovery开始走起

理解DHCP与PPPoE的区别
早期的宽带上网需要点击桌面上的一个应用，然后输入账号密码点击连接，实际上用的就是PPPoE
现在宽带上网直接插上网线就完事了，用的是DHCP自动获取IP地址


- ARP
address resolution protocol
通过网络地址获取mac地址
以太网协议规定，局域网中两台主机想要相互通信，必须要知道mac地址，在网络层只能知道ip地址，想要放到链路层中时，无法知道mac地址。
通过ARP包来获取目标主机的mac地址，包含了自己的ip地址和mac地址，目标的ip地址，请求目标的mac地址，以ARP广播的形式发送出去
目标ip地址的机器收到这个广播，回复一个ARP包，告知对方自己的mac地址
此后两台主机就互相知道mac地址，可以直接通信了
当目标机器不在当前局域网中时，回复的mac地址是某个路由器的mac地址，通过路由器转发到对应的目标机器

每台主机或者路由器都有自己的ARP缓存，否则每次发请求都需要通过ARP广播来进行，如果网络中存在环路，可能造成ARP广播风暴
将交换机上的两个端口直接连起来就会造成ARP风暴


- STP
spanning tree protocol
需要理解网桥
防止交换机冗余链路导致的环路
当网络中某个交换机与根网桥有超过一条链路时，STP会只保留距离最短的那条，断开其他链路，防止ARP风暴


- ICMP
internet control message protocol
通过IP层发送消息，提供网络环境中问题的反馈
依附于IP，IP头+ICMP报文
常用的ping，traceroute都是使用了ICMP
理解ping的工作原理
发送一个IP报文，内容是ICMP echo request，收到ICMP echo reply，表明目标可达
发送时会记录一个时间，如果记录时间+超时时间之后还没有收到reply，记录为一次ping失败

理解traceroute的工作原理
发送的是UDP报文，收到ICMP ttl超时的回复，回复中会有该路由器的ip地址
每次发送3个UDP请求，第一次ttl为1，第二次ttl为2，从而把一层一层的路线给画出来
因为有些防火墙设置了路由器不回复ICMP报文，所以将udp请求的端口号设置为30000以上，UDP规定端口号不可超过30000，所以会回复一个ICMP端口不可达
收到端口不可达的时候，就表示到达了目标主机


- 网关gateway
因为mac地址只能在同一个局域网内通信，所以每次网关转发都会改变mac地址
静态路由：
转发网关，不改变ip地址
NAT网关，改变ip地址


- RP(路由协议)
路由器中存有路由表，路由表保存了一条条记录：
目的网络：包想去哪里
出口：从哪个端口转发出去
下一跳网关：发到这个网关去

路由协议解决三个问题：
Who?  和哪些路由器交换信息
What? 交换什么信息
When? 什么时候交换信息

内部网关协议，运行于自治系统(AS)内部：
RIP:
基于UDP，一种距离向量的路由选择协议（bellman-ford算法）
通过跳数来选择最近的路由，可能在时间上不是最佳，只能用于小型互联网
Who?  直接相邻的路由器
What? 自己的路由表
When? 每个一定的时间间隔

OSPF:
基于IP，一种链路状态路由选择协议（Dijkstra算法）
Who?  所有的路由器，通过洪泛法
What? 与自己相邻的路由器的链路状态
When? 当链路状态发生变化的时候

外部网关协议，运行于自治系统(AS)之间：
BGP:
基于TCP，一种路径向量的路由选择协议。
Who?  自己的邻站
What? 以AS为基本单位，交换的是AS之间的可达性，指到达某个AS所要经过的一系列AS
When? 先建立TCP连接，通过TCP来交换路由的变化，比如新增了路由，或删除了某个路由
